import java.awt.Color;
import java.awt.Component; 
import java.awt.Container;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.LayoutManager;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.Iterator;
import javax.swing.*;

import javax.swing.JPanel;
/**
 * all download
 * @author paml
 *
 */

public class AddNewDownload extends JPanel {
	static ArrayList<DownloadMenu> array;
	public AddNewDownload() {
		System.out.println(this.getSize());
		array=new ArrayList<>();
		//this.setPreferredSize(new Dimension(6000, 700));
	}
	public static void adding(DownloadMenu download)
	{
		//download.setPreferredSize(new Dimension(1650, 70));
		download.setMinimumSize(new Dimension(1650, 70));
		array.add(download);
	}
	public void setting()
	{
		//System.out.println("size="+array.size());
		Iterator<DownloadMenu> iterator=array.iterator();
		if (iterator.hasNext())
		{
			while(iterator.hasNext())
			{
				this.add(iterator.next());
			}
		}
		this.setLayout(new FlowLayout());
	}
	public static void click(int num)
	{
		System.out.println("num="+num);
		for(int i=0 ; i< array.size(); i++)
		{
			//System.out.println(i);
			if (i!=num)
			{
				//System.out.println("YES");
				array.get(i).setClick(false);
				array.get(i).setBackground(null);
			}
		}
		array.get(num).setClick(true);
		
	}
	public void toFile() throws IOException
	{
		File file=new File("list.jdm");
		BufferedWriter bw=null;
		try
		{	
			if (!file.exists())
			{
				file.createNewFile();
			}
			FileWriter fw=new FileWriter(file);
			bw=new BufferedWriter(fw);
			String string;
			Iterator<DownloadMenu> iterator=array.iterator();
			while(iterator.hasNext())
			{
				DownloadMenu dm=iterator.next();
				string=dm.getDownloadName();
				string=string+"\n";
				bw.write(string);
				string=dm.getTime();
				string=string+"\n";
				bw.write(string);
				string=dm.getVolumeOfFile();
				string=string+"\n";
				bw.write(string);
				string=dm.getURL();
				string=string+"\n";
				bw.write(string);
				string=dm.getFile();
				string=string+"\n";
				bw.write(string);
				string=dm.getVolumeOfDownloading();
				string=string+"\n";
				bw.write(string);
			}
		}
		catch (IOException ioe) {
			   ioe.printStackTrace();
			}
			finally
			{ 
			   try{
			      if(bw!=null)
				 bw.close();
			   }catch(Exception ex){
			       System.out.println("Error in closing the BufferedWriter"+ex);
			    }
			}
		//System.out.println("Yes");
		
	}
	public  void getFile()
	{
		System.out.println("newwwwww");
		String firstLine="1";
		File file=new File("list.jdm");
		BufferedWriter bw=null;
		try
		{	
			if (!file.exists())
			{
				file.createNewFile();
			}
			BufferedReader br=new BufferedReader(new InputStreamReader(new FileInputStream(file)));
			do
			{
				String gettingdownloadName=br.readLine();
				if (gettingdownloadName!=null)
				{
					String gettingTime=br.readLine();
					String gettingVolumeOfFile=br.readLine();
					DownloadMenu dl=new DownloadMenu(gettingdownloadName, gettingVolumeOfFile, gettingTime);
					firstLine=br.readLine();
					dl.setURL(firstLine);
					firstLine=br.readLine();
					dl.setFile(firstLine);
					firstLine=br.readLine();
					dl.setVolumeOfDownloading(firstLine);
					this.adding(dl);
				}
				else
				{
					firstLine=null;
				}
			}while(firstLine!=null);
		}
		catch (IOException ioe) {
			   ioe.printStackTrace();
			}
			finally
			{ 
			   try{
			      if(bw!=null)
				 bw.close();
			      this.setting();
			   }catch(Exception ex){
			       System.out.println("Error in closing the BufferedWriter"+ex);
			    }
			}
		
	}
	public  void removeFile(int i)
	{
		File file=new File("removed.jdm");
		String string;
		BufferedWriter bw=null;
		try
		{	
			if (!file.exists())
			{
				file.createNewFile();
			}
			FileWriter fw=new FileWriter(file);
			bw=new BufferedWriter(fw);
			DownloadMenu dm=array.get(i);
			string=dm.getDownloadName();
			string=string+"\n";
			bw.write(string);
			string=dm.getURL();
			string=string+"\n";
			bw.write(string);
			System.out.println("iiiiiiiiii="+i);
			this.remove(array.get(i));
			this.revalidate();
			array.remove(i);
			System.out.println("remove file size"+array.size());
		}
		catch (IOException ioe) {
			   ioe.printStackTrace();
			}
			finally
			{ 
			   try{
			      if(bw!=null)
			    	  
				 {
			    	  bw.close();
			    	  this.toFile();
			    	  this.setting();
				 }
			   }catch(Exception ex){
			       System.out.println("Error in closing the BufferedWriter"+ex);
			    }
			}
		//System.out.println("Yes");
	}
	public void find() throws IOException
	{
		Iterator<DownloadMenu> iterator=array.iterator();
		int i=0;
		while(iterator.hasNext())
		{
			DownloadMenu dm=iterator.next();
			if (dm.getClick()==true)
			{
				removeFile(i);
				System.out.println("size="+array.size());
				System.out.println("finish+i"+i);
				for(int j=i; j<array.size() ; j++)
				{
					System.out.println("no"+j);
					array.get(j).setNumber();
					DownloadMenu.numberOfDownloads--;
				}
				break;
			}
			else
			{
				i++;
			}
		}
	}
	public void showRunTime()
	{
		this.revalidate();
		setting();
	}
}
